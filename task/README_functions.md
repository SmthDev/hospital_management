# Проект: Система учета пациентов

* **ФИО:** ИВАНЕНКО Константин Сергеевич
* **Группа:** 353501

---

## 1. Тема проекта

Разработка **информационной системы учета пациентов** для автоматизации работы медицинской организации.  
Система предназначена для хранения информации о пациентах, врачах, услугах, обследованиях, назначениях и оплатах, а также для разграничения доступа пользователей по ролям и ведения журнала действий.

---

## 2. Функциональные требования

### I. Основные возможности

#### 1. Неавторизованный пользователь:
* Регистрация нового аккаунта.
* Вход в систему.

#### 2. Авторизованный пользователь (гость):
* Просмотр информации о пациентах, врачах, услугах, обследованиях, расписании.
* Управление личным профилем (редактирование данных).
* Экспорт таблиц в форматы `.xlsx` и `.csv`.
* Экспорт карточек пациентов и результатов обследований в формате `.pdf`.

#### 3. Авторизованный пользователь (медицинский работник):
* CRUD-операции с данными пациентов (создание, просмотр, редактирование, удаление).
* Назначение обследований пациентам.
* Работа с данными о препаратах: просмотр, назначение пациентам.

#### 4. Администратор:
* CRUD-операции с пользователями, ролями, отделениями, должностями, услугами и препаратами.
* Управление правами доступа.

#### 5. Система ролей:
* Разграничение прав доступа для разных категорий пользователей.

#### 6. Журналирование:
* Запись действий пользователей (создание, редактирование, вход/выход и т.д.).

---

## 3. Проектирование базы данных (БД)

### 3.1. Список сущностей

| №   | Таблица                | Назначение               |
| --- | ---------------------- | ------------------------ |
| 1   | **role**               | Роли пользователей       |
| 2   | **patient**            | Информация о пациентах   |
| 3   | **staff**              | Информация о сотрудниках |
| 4   | **department**         | Отделения                |
| 5   | **position**           | Должности                |
| 6   | **service**            | Медицинские услуги       |
| 7   | **medicine**           | Препараты                |
| 8   | **medicine_operation** | Операции с препаратами   |
| 9   | **schedule**          | Расписание приёмов       |
| 10  | **examination**        | Обследования             |
| 11  | **provided_service**   | Оказанные услуги         |
| 12  | **prescribtion**       | Рецепты                  |
| 13  | **purchase**           | Оплаты                   |
| 14  | **logs**               | Журнал действий          |

---

### 3.2. Подробное описание таблиц

#### 1. `role` (Роли)
| Поле   | Тип         | Описание                                                                                                       |
| ------ | ----------- | -------------------------------------------------------------------------------------------------------------- |
| `id`   | BIGINT (PK) | Уникальный идентификатор роли.                                                                                 |
| `name` | VARCHAR(16) | Название роли (например, “Администратор”, “Врач”, “Регистратор”). Используется для разграничения прав доступа. |

#### 2. `patient` (Пациенты)
| Поле           | Тип          | Описание                                                       |
| -------------- | ------------ | -------------------------------------------------------------- |
| `id`           | BIGINT (PK)  | Уникальный идентификатор пациента.                             |
| `full_name`    | VARCHAR(64)  | Полное имя пациента (Фамилия Имя Отчество).                    |
| `sex`          | VARCHAR(1)   | Пол пациента: `M` — мужской, `F` — женский.                    |
| `birth_date`   | DATE         | Дата рождения пациента. Используется для определения возраста. |
| `address`      | VARCHAR(128) | Адрес проживания пациента (город, улица, дом).                 |
| `phone_number` | VARCHAR(15)  | Контактный номер телефона для связи.                           |
| `email`        | VARCHAR(320) | Электронная почта пациента для уведомлений.                    |
| `card_number`  | VARCHAR(8)   | Уникальный номер медицинской карты пациента.                   |

#### 3. `staff` (Сотрудники)
| Поле         | Тип          | Описание                                             |
| ------------ | ------------ | ---------------------------------------------------- |
| `id`         | BIGINT (PK)  | Уникальный идентификатор сотрудника.                 |
| `full_name`  | VARCHAR(64)  | Полное имя сотрудника (ФИО).                         |
| `birth_date` | DATE         | Дата рождения.                                       |
| `email`      | VARCHAR(320) | Рабочий email сотрудника.                            |
| `position`   | BIGINT (FK)  | Идентификатор должности (ссылка на `position.id`).   |
| `department` | BIGINT (FK)  | Идентификатор отделения (ссылка на `department.id`). |
| `role`       | BIGINT (FK)  | Роль сотрудника в системе (ссылка на `role.id`).     |
| `login`      | VARCHAR(32)  | Уникальный логин для входа в систему.                |
| `password`   | VARCHAR(32)  | Хэшированный пароль для аутентификации.              |

#### 4. `department` (Отделения)
| Поле   | Тип         | Описание                                              |
| ------ | ----------- | ----------------------------------------------------- |
| `id`   | BIGINT (PK) | Уникальный идентификатор отделения.                   |
| `name` | VARCHAR(32) | Название отделения (например, “Хирургия”, “Терапия”). |

#### 5. `position` (Должности)
| Поле   | Тип         | Описание                                                           |
| ------ | ----------- | ------------------------------------------------------------------ |
| `id`   | BIGINT (PK) | Уникальный идентификатор должности.                                |
| `name` | VARCHAR(32) | Название должности (например, “Врач”, “Медсестра”, “Регистратор”). |

#### 6. `service` (Услуги)
| Поле       | Тип          | Описание                                                          |
| ---------- | ------------ | ----------------------------------------------------------------- |
| `id`       | BIGINT (PK)  | Уникальный идентификатор услуги.                                  |
| `name`     | VARCHAR(64)  | Название медицинской услуги (например, “Консультация терапевта”). |
| `duration` | INTEGER      | Продолжительность услуги в минутах.                               |
| `price`    | DECIMAL(6,2) | Стоимость услуги в рублях.                                        |

#### 7. `medicine` (Препараты)
| Поле          | Тип          | Описание                                               |
| ------------- | ------------ | ------------------------------------------------------ |
| `id`          | BIGINT (PK)  | Уникальный идентификатор препарата.                    |
| `name`        | VARCHAR(32)  | Название препарата.                                    |
| `description` | VARCHAR(256) | Краткое описание препарата.                            |
| `category`    | VARCHAR(32)  | Категория препарата (например, антибиотики, витамины). |
| `amount`      | INT          | Количество доступных единиц на складе.                 |
| `warranty`    | INT          | Срок годности в днях.                                  |

#### 8. `medicine_operation` (Операции с препаратами)
| Поле          | Тип          | Описание                                 |
| ------------- | ------------ | ---------------------------------------- |
| `id`          | BIGINT (PK)  | Уникальный идентификатор операции.       |
| `medicine_id` | BIGINT (FK)  | Ссылка на препарат (`medicine.id`).      |
| `operation`   | VARCHAR(32)  | Тип операции: “поступление”, “списание”. |
| `amount`      | INT          | Количество единиц препарата в операции.  |
| `price`       | DECIMAL(6,2) | Стоимость операции.                      |
| `date`        | DATE         | Дата проведения операции.                |

#### 9. `schedule` (Расписание)
| Поле         | Тип         | Описание                                    |
| ------------ | ----------- | ------------------------------------------- |
| `id`         | BIGINT (PK) | Уникальный идентификатор записи расписания. |
| `staff_id`   | BIGINT (FK) | Ссылка на сотрудника (врача).               |
| `patient_id` | BIGINT (FK) | Ссылка на пациента.                         |
| `paid`       | BOOLEAN     | Оплачен ли приём.                           |
| `abscent`    | BOOLEAN     | Посетил ли пациент приём.                   |
| `date_time`  | DATETIME    | Дата и время приёма.                        |

#### 10. `examination` (Обследования)
| Поле          | Тип          | Описание                                     |
| ------------- | ------------ | -------------------------------------------- |
| `id`          | BIGINT (PK)  | Уникальный идентификатор обследования.       |
| `schedule_id` | BIGINT (FK)  | Ссылка на расписание приёма.                 |
| `type`        | VARCHAR(32)  | Тип обследования (например, “анализ крови”). |
| `disease`     | VARCHAR(128) | Диагноз по результатам обследования.         |
| `result`      | VARCHAR(256) | Описание результатов обследования.           |

#### 11. `provided_service` (Оказанные услуги)
| Поле          | Тип         | Описание                                       |
| ------------- | ----------- | ---------------------------------------------- |
| `id`          | BIGINT (PK) | Уникальный идентификатор оказанной услуги.     |
| `service_id`  | BIGINT (FK) | Ссылка на услугу (`service.id`).               |
| `schedule_id` | BIGINT (FK) | Ссылка на запись в расписании (`schedule.id`). |

#### 12. `prescribtion` (Рецепты)
| Поле             | Тип         | Описание                          |
| ---------------- | ----------- | --------------------------------- |
| `id`             | BIGINT (PK) | Уникальный идентификатор рецепта. |
| `examination_id` | BIGINT (FK) | Ссылка на обследование.           |
| `medicine_id`    | BIGINT (FK) | Ссылка на препарат.               |

#### 13. `purchase` (Оплаты)
| Поле         | Тип          | Описание                         |
| ------------ | ------------ | -------------------------------- |
| `id`         | BIGINT (PK)  | Уникальный идентификатор оплаты. |
| `service_id` | BIGINT (FK)  | Ссылка на оказанную услугу.      |
| `patient_id` | BIGINT (FK)  | Ссылка на пациента.              |
| `total`      | DECIMAL(6,2) | Общая сумма оплаты.              |
| `paid`       | BOOLEAN      | Флаг оплаты.                     |
| `date_time`  | DATETIME     | Дата и время оплаты.             |

#### 14. `logs` (Журнал действий)
| Поле          | Тип          | Описание                                           |
| ------------- | ------------ | -------------------------------------------------- |
| `id`          | BIGINT (PK)  | Уникальный идентификатор записи лога.              |
| `user_id`     | BIGINT (FK)  | Идентификатор пользователя, совершившего действие. |
| `action`      | VARCHAR(200) | Краткое описание действия.                         |
| `object_type` | VARCHAR(100) | Тип объекта (таблица, с которой работали).         |
| `object_id`   | BIGINT       | ID объекта, над которым было действие.             |
| `created_at`  | TIMESTAMPTZ  | Время выполнения действия.                         |

---

## 4. Схема данных

* **One-to-Many:**  
  * `role` → `staff`  
  * `department` → `staff`  
  * `position` → `staff`  
* **One-to-One:**  
  * `schedule` → `examination`
* **Many-to-Many:**  
  * `schedule` ↔ `service` через `provided_service`
  * `examination` ↔ `medicine` через `prescribtion`
